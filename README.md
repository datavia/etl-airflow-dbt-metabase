## ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð²

- .github/workflows/docker-publish.yml â€” GitHub Actions workflow, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð¸Ñ€ÑƒÐµÑ‚ Ð¿Ñ€Ð¾Ñ†ÐµÑÑ Ð¿Ð¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ñ Docker-Ð¾Ð±Ñ€Ð°Ð·Ð° Ð¸ ÐµÐ³Ð¾ Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ð¸ Ð² Docker Hub.
- dags/ â€” Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ñ„Ð°Ð¹Ð»Ñ‹ Ð´Ð°Ð³Ð¾Ð² Ð´Ð»Ñ Apache Airflow, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¾Ð¿Ð¸ÑÑ‹Ð²Ð°ÑŽÑ‚ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð¸ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ….
- scripts/ â€” Ð’ ÑÑ‚Ð¾Ð¹ Ð¿Ð°Ð¿ÐºÐµ Ð½Ð°Ñ…Ð¾Ð´ÑÑ‚ÑÑ ÑÐºÑ€Ð¸Ð¿Ñ‚Ñ‹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑŽÑ‚ Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ ÑÑ‚Ð°Ð¿Ñ‹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…, Ð¸Ñ… Ñ‚Ñ€Ð°Ð½ÑÑ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¸ Ñ‚.Ð´.).
- Dockerfile â€” Ð¤Ð°Ð¹Ð», ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¾Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÑ‚, ÐºÐ°Ðº ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°, Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÑƒ Ð²ÑÐµÑ… Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ñ… Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹.
- docker-compose.yml â€” Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° Airflow.


## Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°

### Ð¢Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ

Ð”Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð¼ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð¸Ð¼ÐµÑ‚ÑŒ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ðµ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:

- Docker
- Docker Compose
- GitHub (Ð´Ð»Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ CI/CD)

### Ð¡Ð¾Ð·Ð´Ð°Ð¹ Ñ„Ð°Ð¹Ð» .env
Ð¤Ð°Ð¹Ð» .env Ð½ÑƒÐ¶ÐµÐ½ Ð´Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ ÑÐµÐºÑ€ÐµÑ‚Ð½ÑƒÑŽ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ.
1. Ð¡Ð¾Ð·Ð´Ð°Ð¹ .env Ð² ÐºÐ¾Ñ€Ð½Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°:
```bash
cp .env.example .env
```
2. ÐžÑ‚Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€ÑƒÐ¹ .env Ð¿Ð¾Ð´ ÑÐµÐ±Ñ.

Ð’Ð°Ð¶Ð½Ð¾: Ñ„Ð°Ð¹Ð» .env Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð² .gitignire Ð¸ Ð½Ðµ Ð¿Ð¾Ð¿Ð°Ð´Ð°ÐµÑ‚ Ð² Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹. ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÑÐ¾Ð·Ð´Ð°Ñ‘Ñ‚ ÐµÐ³Ð¾ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾. Ð’Ð¼ÐµÑÑ‚Ð¾ Ð½ÐµÐ³Ð¾ Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚Ðµ ÐµÑÑ‚ÑŒ .env.example - ÑˆÐ°Ð±Ð»Ð¾Ð½, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¼Ð¾Ð¶Ð½Ð¾ ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ.

## Ð Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð² ÑÐ²Ð¾ÐµÐ¹ Ð²ÐµÑ‚ÐºÐµ

### ÐšÐ»Ð¾Ð½Ð¸Ñ€ÑƒÐ¹ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹

1. Ð£Ð±ÐµÐ´Ð¸ÑÑŒ, Ñ‡Ñ‚Ð¾ Ñƒ Ñ‚ÐµÐ±Ñ ÐµÑÑ‚ÑŒ SSH-ÐºÐ»ÑŽÑ‡
    1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ ÐºÐ»ÑŽÑ‡ÐµÐ¹:
        ```bash
        ls ~/.ssh/id_rsa.pub
        ```
    2. Ð•ÑÐ»Ð¸ ÐºÐ»ÑŽÑ‡Ð° Ð½ÐµÑ‚ - ÑÐ¾Ð·Ð´Ð°Ð¹ ÐµÐ³Ð¾:
        ```bash
        ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
        ```
    (Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¶Ð¼Ð¸ Enter Ð½Ð° Ð²ÑÐµÑ… ÑˆÐ°Ð³Ð°Ñ…)

2. Ð”Ð¾Ð±Ð°Ð²ÑŒ Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡ Ð² GitHub
    1. Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹ ÐºÐ»ÑŽÑ‡:
        ```bash
        cat ~/.ssh/id_rsa.pub
        ```
    2. ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸ Ð² GitHub -> Settings -> SSH and GPG keys
    3. ÐÐ°Ð¶Ð¼Ð¸ "New SSH key"
    4. Ð’ÑÑ‚Ð°Ð²ÑŒ ÐºÐ»ÑŽÑ‡ Ð¸ Ð½Ð°Ð¶Ð¼Ð¸ "Add SSH key"
3. ÐšÐ»Ð¾Ð½Ð¸Ñ€ÑƒÐ¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚:
    ```bash
    git clone git@github.com:ArinaExpy/project_lab08.git
    cd project_lab08
    ```
4. (ÐžÐ¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾) ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒ, Ñ‡Ñ‚Ð¾ Ð²ÑÑ‘ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚
    ```bash
    ssh -T git@github.com
    ```

### Ð£ÐºÐ°Ð¶Ð¸ Ð¸Ð¼Ñ ÑÐ²Ð¾ÐµÐ¹ Ð²ÐµÑ‚ÐºÐ¸ Ð´Ð»Ñ Git Sync Ð² .env
Ð‘Ñ‹Ð»Ð¾:
```
GIT_BRANCH=main
```
Ð¡Ñ‚Ð°Ð»Ð¾:
```
GIT_BRANCH=feature/my-cool-change
```

### Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Airflow
ÐŸÐ¾ÑÐ»Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ° Airflow Ð±ÑƒÐ´ÐµÑ‚ Ð¿Ð¾Ð´Ð³Ñ€ÑƒÐ¶Ð°Ñ‚ÑŒ DAG-Ð¸ Ð¸Ð· GitHub (Ð¸Ð· Ñ‚Ð²Ð¾ÐµÐ¹ Ð²ÐµÑ‚ÐºÐ¸) Ð¸ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ Ð¸Ñ… Ð² Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐµ: https://localhost:8080
```bash
docker compose up --build -d
```

### Ð¡Ð¾Ð·Ð´Ð°Ð¹ ÑÐ²Ð¾ÑŽ Ð²ÐµÑ‚ÐºÑƒ
```bash
git checkout -b feature/my-cool-change
git push --set-upstream origin feature/my-cool-change
```
Ð’Ð°Ð¶Ð½Ð¾: Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð½Ðµ Ð¿Ð¾Ð¿Ð°Ð´ÑƒÑ‚ Ð² Airflow, Ð¿Ð¾ÐºÐ° Ñ‚Ñ‹ Ð½Ðµ Ð·Ð°Ð¿ÑƒÑˆÐ¸ÑˆÑŒ Ð¸Ñ… Ð² Git!

# Ð¡Ñ…ÐµÐ¼Ð° Ð˜Ð½Ñ„Ñ€Ð°ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹

```mermaid
flowchart TD
    DockerHub[(ðŸ›³ï¸Docker Hub Image Repository)] -->|Pull images| DockerCompose
    GitHub["ðŸ“‚GitHub Repository"] -->|Sync DAGs| GitSync

    subgraph DockerCompose["ðŸ› ï¸Docker Compose"]
        Webserver[ðŸ–¥ï¸Airflow Webserver]
        Scheduler[â°Airflow Scheduler]
        GitSync["ðŸ”„GitSync "]
    end

    GitSync --> Webserver
    GitSync --> Scheduler

    Scheduler --> DAG

    subgraph DAG["âš™ï¸Airflow DAG (@hourly)"]
        direction LR
        DAGStart([â–¶ï¸Start DAG]) --> Task1_LoadS3["â¬‡ï¸Task 1: Load Raw Data from Yandex S3 (STG)"] --> Task2_DBT["âš¡Task 2: Run DBT models (ODS, Marts)"] --> DAGEnd([â¹ï¸End DAG])
    end

    YandexS3[(â˜ï¸Yandex Cloud S3 Storage)] -->|Provide raw data| Task1_LoadS3

    Task2_DBT --> PostgreSQL[(ðŸ—„ï¸PostgreSQL Database)]

    Webserver -->|Trigger/View DAGs| Scheduler
    PostgreSQL -->|Read marts data| Metabase["ðŸ“ŠMetabase (Dashboards)"]
```

# Ð¡Ñ…ÐµÐ¼Ð° Ð‘Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… 

```mermaid
flowchart TD
    subgraph STG [Stage Layer]
        stg_browser_events[stg.stg_browser_events]
        stg_geo_events[stg.stg_geo_events]
        stg_device_events[stg.stg_device_events]
        stg_location_events[stg.stg_location_events]
    end

    subgraph ODS [ODS Layer]
        ods_browser_events[ods.ods_browser_events]
        ods_geo_events[ods.ods_geo_events]
        ods_device_events[ods.ods_device_events]
        ods_location_events[ods.ods_location_events]
    end

    stg_browser_events --> ods_browser_events
    stg_geo_events --> ods_geo_events
    stg_device_events --> ods_device_events
    stg_location_events --> ods_location_events
```
