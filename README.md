## ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²

- .github/workflows/docker-publish.yml â€” GitHub Actions workflow, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ñ Docker-Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ° Ğ¸ ĞµĞ³Ğ¾ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ Ğ² Docker Hub.
- dags/ â€” Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ´Ğ°Ğ³Ğ¾Ğ² Ğ´Ğ»Ñ Apache Airflow, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¾Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ÑÑ‚ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ¸ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ»Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….
- dbt/ - Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ñ ODS/DM Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ² Ñ€Ğ°Ğ¼ĞºĞ°Ñ… DAG-Ğ° Airflow.
- scripts/ â€” Ğ’ ÑÑ‚Ğ¾Ğ¹ Ğ¿Ğ°Ğ¿ĞºĞµ Ğ½Ğ°Ñ…Ğ¾Ğ´ÑÑ‚ÑÑ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ñ‹, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑÑ‚ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºÑƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ· Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ° Yandex.Cloud S3 Storage.
- .env.example - Template Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ.
- Dockerfile â€” Ğ¤Ğ°Ğ¹Ğ», ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ¾Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚, ĞºĞ°Ğº ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°, Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºÑƒ Ğ²ÑĞµÑ… Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ñ‹Ñ… Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹.
- docker-compose.yml â€” Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° Airflow.
- entrypoint.sh - Bash ÑĞºÑ€Ğ¸Ğ¿Ñ‚, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ² docker-compose.yml.
- requirements.txt - Ğ¥Ñ€Ğ°Ğ½Ğ¸Ñ‚ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ² Dockerfile.


## ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°

### Ğ¢Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

Ğ”Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ¼ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ Ğ¸Ğ¼ĞµÑ‚ÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹:

- Docker
- Docker Compose
- GitHub (Ğ´Ğ»Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ CI/CD)

### Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹ Ñ„Ğ°Ğ¹Ğ» .env
Ğ¤Ğ°Ğ¹Ğ» .env Ğ½ÑƒĞ¶ĞµĞ½ Ğ´Ğ»Ñ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ ÑĞµĞºÑ€ĞµÑ‚Ğ½ÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ.
1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹ .env Ğ² ĞºĞ¾Ñ€Ğ½Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°:
```bash
cp .env.example .env
```
2. ĞÑ‚Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€ÑƒĞ¹ .env Ğ¿Ğ¾Ğ´ ÑĞµĞ±Ñ.

Ğ’Ğ°Ğ¶Ğ½Ğ¾: Ñ„Ğ°Ğ¹Ğ» .env Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ² .gitignire Ğ¸ Ğ½Ğµ Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚ Ğ² Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹. ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ ĞµĞ³Ğ¾ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾. Ğ’Ğ¼ĞµÑÑ‚Ğ¾ Ğ½ĞµĞ³Ğ¾ Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğµ ĞµÑÑ‚ÑŒ .env.example - ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ.

## Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ğ² ÑĞ²Ğ¾ĞµĞ¹ Ğ²ĞµÑ‚ĞºĞµ

### ĞšĞ»Ğ¾Ğ½Ğ¸Ñ€ÑƒĞ¹ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹

1. Ğ£Ğ±ĞµĞ´Ğ¸ÑÑŒ, Ñ‡Ñ‚Ğ¾ Ñƒ Ñ‚ĞµĞ±Ñ ĞµÑÑ‚ÑŒ SSH-ĞºĞ»ÑÑ‡
    1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ ĞºĞ»ÑÑ‡ĞµĞ¹:
        ```bash
        ls ~/.ssh/id_rsa.pub
        ```
    2. Ğ•ÑĞ»Ğ¸ ĞºĞ»ÑÑ‡Ğ° Ğ½ĞµÑ‚ - ÑĞ¾Ğ·Ğ´Ğ°Ğ¹ ĞµĞ³Ğ¾:
        ```bash
        ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
        ```
    (Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ¶Ğ¼Ğ¸ Enter Ğ½Ğ° Ğ²ÑĞµÑ… ÑˆĞ°Ğ³Ğ°Ñ…)

2. Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡ Ğ² GitHub
    1. Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞ¹ ĞºĞ»ÑÑ‡:
        ```bash
        cat ~/.ssh/id_rsa.pub
        ```
    2. ĞŸĞµÑ€ĞµĞ¹Ğ´Ğ¸ Ğ² GitHub -> Settings -> SSH and GPG keys
    3. ĞĞ°Ğ¶Ğ¼Ğ¸ "New SSH key"
    4. Ğ’ÑÑ‚Ğ°Ğ²ÑŒ ĞºĞ»ÑÑ‡ Ğ¸ Ğ½Ğ°Ğ¶Ğ¼Ğ¸ "Add SSH key"
3. ĞšĞ»Ğ¾Ğ½Ğ¸Ñ€ÑƒĞ¹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚:
    ```bash
    git clone git@github.com:ArinaExpy/project_lab08.git
    cd project_lab08
    ```
4. (ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾) ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ, Ñ‡Ñ‚Ğ¾ Ğ²ÑÑ‘ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚
    ```bash
    ssh -T git@github.com
    ```

### Ğ£ĞºĞ°Ğ¶Ğ¸ Ğ¸Ğ¼Ñ ÑĞ²Ğ¾ĞµĞ¹ Ğ²ĞµÑ‚ĞºĞ¸ Ğ´Ğ»Ñ Git Sync Ğ² .env
Ğ‘Ñ‹Ğ»Ğ¾:
```
GIT_BRANCH=main
```
Ğ¡Ñ‚Ğ°Ğ»Ğ¾:
```
GIT_BRANCH=feature/my-cool-change
```

### Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Airflow
ĞŸĞ¾ÑĞ»Ğµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° Airflow Ğ±ÑƒĞ´ĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ³Ñ€ÑƒĞ¶Ğ°Ñ‚ÑŒ DAG-Ğ¸ Ğ¸Ğ· GitHub (Ğ¸Ğ· Ñ‚Ğ²Ğ¾ĞµĞ¹ Ğ²ĞµÑ‚ĞºĞ¸) Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ¸Ñ… Ğ² Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞµ: https://localhost:8080
```bash
docker compose up --build -d
```

### Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹ ÑĞ²Ğ¾Ñ Ğ²ĞµÑ‚ĞºÑƒ
```bash
git checkout -b feature/my-cool-change
git push --set-upstream origin feature/my-cool-change
```
Ğ’Ğ°Ğ¶Ğ½Ğ¾: Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ½Ğµ Ğ¿Ğ¾Ğ¿Ğ°Ğ´ÑƒÑ‚ Ğ² Airflow, Ğ¿Ğ¾ĞºĞ° Ñ‚Ñ‹ Ğ½Ğµ Ğ·Ğ°Ğ¿ÑƒÑˆĞ¸ÑˆÑŒ Ğ¸Ñ… Ğ² Git!

# Ğ¡Ñ…ĞµĞ¼Ğ° Ğ˜Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ TD

```mermaid
flowchart TD
    DockerHub[(ğŸ›³ï¸Docker Hub Image Repository)] -->|Pull images| DockerCompose
    GitHub["ğŸ“‚GitHub Repository"] -->|Sync DAGs| GitSync

    subgraph DockerCompose["ğŸ› ï¸Docker Compose"]
        Webserver[ğŸ–¥ï¸Airflow Webserver]
        Scheduler[â°Airflow Scheduler]
        GitSync["ğŸ”„GitSync "]
    end

    GitSync --> Webserver
    GitSync --> Scheduler

    Scheduler --> DAG

    subgraph DAG["âš™ï¸Airflow DAG (@hourly)"]
        direction LR
        DAGStart([â–¶ï¸Start DAG]) --> Task1_LoadS3["â¬‡ï¸Task 1: Load Raw Data from Yandex S3 (STG)"] --> Task2_DBT["âš¡Task 2: Run DBT models (ODS, Marts)"] --> DAGEnd([â¹ï¸End DAG])
    end

    YandexS3[(â˜ï¸Yandex Cloud S3 Storage)] -->|Provide raw data| Task1_LoadS3

    Task2_DBT --> PostgreSQL[(ğŸ—„ï¸PostgreSQL Database)]

    Webserver -->|Trigger/View DAGs| Scheduler
    PostgreSQL -->|Read marts data| Metabase["ğŸ“ŠMetabase (Dashboards)"]
```

# Ğ¡Ñ…ĞµĞ¼Ğ° Ğ˜Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ LR

```mermaid
flowchart LR
    DockerHub[(ğŸ›³ï¸ Docker Hub Image Repository)] -->|Pull images| DockerCompose
    GitHub["ğŸ“‚ GitHub Repository"] -->|Sync DAGs| GitSync

    subgraph DockerCompose["ğŸ› ï¸ Docker Compose"]
        Webserver[ğŸ–¥ï¸ Airflow Webserver]
        Scheduler[â° Airflow Scheduler]
        GitSync["ğŸ”„ GitSync"]
        DBTDocs
    end

    GitSync --> Webserver
    GitSync --> Scheduler

    Scheduler --> |schedules| DAG
    Webserver --> |view/trigger| DAG

    YandexS3[(â˜ï¸ Yandex Cloud S3 Storage)] -->|Provide raw data| Task1_LoadS3

    subgraph DAG["âš™ï¸ Airflow DAG (@hourly)"]
        direction LR
        DAGStart([â–¶ï¸ Start DAG]) --> Task1_LoadS3["â¬‡ï¸ Task 1: Load Raw Data from Yandex S3 (STG)"] --> Task2_DBT["âš¡ Task 2: Run DBT models (ODS, Marts)"] --> DAGEnd([â¹ï¸ End DAG])
    end

    Task2_DBT --> PostgreSQL[(ğŸ—„ï¸ PostgreSQL Database)]

    PostgreSQL -->|Read marts data| Metabase["ğŸ“Š Metabase (Dashboards)"]

    style DAG fill:#f9f9f9,stroke:#333
```

# Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ‘Ğ°Ğ·Ñ‹ Ğ”Ğ°Ğ½Ğ½Ñ‹Ñ… 
http://217.16.20.100:8088/
