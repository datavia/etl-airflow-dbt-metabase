{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.8.7", "generated_at": "2025-04-30T09:44:56.336030Z", "invocation_id": "24540e62-7b86-4145-a7ae-4ecc91f34577", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-30T09:42:04.526150Z", "completed_at": "2025-04-30T09:42:04.603489Z"}, {"name": "execute", "started_at": "2025-04-30T09:42:04.604172Z", "completed_at": "2025-04-30T09:43:58.461045Z"}], "thread_id": "Thread-3", "execution_time": 113.93854427337646, "adapter_response": {"_message": "INSERT 0 0", "code": "INSERT", "rows_affected": 0}, "message": "INSERT 0 0", "failures": null, "unique_id": "model.dbt_lab08_project.ods_geo_events", "compiled": true, "compiled_code": "select\n    load_dttm as load_hour,\n    (json_data ->> 'click_id')::uuid as click_id,\n    (json_data ->> 'geo_latitude')::float as geo_latitude,\n    (json_data ->> 'geo_longitude')::float as geo_longitude,\n    json_data ->> 'geo_country' as geo_country,\n    json_data ->> 'geo_timezone' as geo_timezone,\n    json_data ->> 'geo_region_name' as geo_region_name,\n    json_data ->> 'ip_address' as ip_address\nfrom \"lab08_db\".\"stg\".\"stg_geo_events\"\n\n\n    where load_dttm > (\n        select coalesce(max(load_hour), '1900-01-01')\n        from \"lab08_db\".\"ods\".\"ods_geo_events\"\n    )\n", "relation_name": "\"lab08_db\".\"ods\".\"ods_geo_events\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-30T09:42:04.527690Z", "completed_at": "2025-04-30T09:42:04.609997Z"}, {"name": "execute", "started_at": "2025-04-30T09:42:04.617968Z", "completed_at": "2025-04-30T09:44:03.992909Z"}], "thread_id": "Thread-4", "execution_time": 119.46767258644104, "adapter_response": {"_message": "INSERT 0 0", "code": "INSERT", "rows_affected": 0}, "message": "INSERT 0 0", "failures": null, "unique_id": "model.dbt_lab08_project.ods_location_events", "compiled": true, "compiled_code": "select\n    load_dttm as load_hour,\n    (json_data ->> 'event_id')::uuid as event_id,\n    json_data ->> 'page_url' as page_url,\n    json_data ->> 'page_url_path' as page_url_path,\n    json_data ->> 'referer_url' as referer_url,\n    json_data ->> 'referer_medium' as referer_medium,\n    json_data ->> 'utm_medium' as utm_medium,\n    json_data ->> 'utm_source' as utm_source,\n    json_data ->> 'utm_content' as utm_content,\n    json_data ->> 'utm_campaign' as utm_campaign\nfrom \"lab08_db\".\"stg\".\"stg_location_events\"\n\n\n    where load_dttm > (\n        select coalesce(max(load_hour), '1900-01-01')\n        from \"lab08_db\".\"ods\".\"ods_location_events\"\n    )\n", "relation_name": "\"lab08_db\".\"ods\".\"ods_location_events\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-30T09:42:04.524309Z", "completed_at": "2025-04-30T09:42:04.602231Z"}, {"name": "execute", "started_at": "2025-04-30T09:42:04.611829Z", "completed_at": "2025-04-30T09:44:06.278569Z"}], "thread_id": "Thread-2", "execution_time": 121.75772619247437, "adapter_response": {"_message": "INSERT 0 0", "code": "INSERT", "rows_affected": 0}, "message": "INSERT 0 0", "failures": null, "unique_id": "model.dbt_lab08_project.ods_device_events", "compiled": true, "compiled_code": "select\n    load_dttm as load_hour,\n    (json_data ->> 'click_id')::uuid as click_id,\n    (json_data ->> 'device_is_mobile')::bool as device_is_mobile,\n    (json_data ->> 'user_domain_id')::uuid as user_domain_id,\n    json_data ->> 'os' as os,\n    json_data ->> 'os_name' as os_name,\n    json_data ->> 'os_timezone' as os_timezone,\n    json_data ->> 'device_type' as device_type,\n    json_data ->> 'user_custom_id' as user_custom_id\nfrom \"lab08_db\".\"stg\".\"stg_device_events\"\n\n\n    where load_dttm > (\n        select coalesce(max(load_hour), '1900-01-01')\n        from \"lab08_db\".\"ods\".\"ods_device_events\"\n    )\n", "relation_name": "\"lab08_db\".\"ods\".\"ods_device_events\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-30T09:42:04.517038Z", "completed_at": "2025-04-30T09:42:04.588082Z"}, {"name": "execute", "started_at": "2025-04-30T09:42:04.588975Z", "completed_at": "2025-04-30T09:44:09.227097Z"}], "thread_id": "Thread-1", "execution_time": 124.71445798873901, "adapter_response": {"_message": "INSERT 0 0", "code": "INSERT", "rows_affected": 0}, "message": "INSERT 0 0", "failures": null, "unique_id": "model.dbt_lab08_project.ods_browser_events", "compiled": true, "compiled_code": "select\n    load_dttm as load_hour,\n    (json_data ->> 'event_id')::uuid as event_id,\n    (json_data ->> 'event_timestamp')::timestamp as event_timestamp,\n    (json_data ->> 'click_id')::uuid as click_id,\n    json_data ->> 'event_type' as event_type,\n    json_data ->> 'browser_name' as browser_name,\n    json_data ->> 'browser_user_agent' as browser_user_agent,\n    json_data ->> 'browser_language' as browser_language\nfrom \"lab08_db\".\"stg\".\"stg_browser_events\"\n\n\n    where load_dttm > (\n        select COALESCE(MAX(load_hour), '1900-01-01')\n        from \"lab08_db\".\"ods\".\"ods_browser_events\"\n    )\n", "relation_name": "\"lab08_db\".\"ods\".\"ods_browser_events\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-30T09:44:09.251037Z", "completed_at": "2025-04-30T09:44:09.316160Z"}, {"name": "execute", "started_at": "2025-04-30T09:44:09.318029Z", "completed_at": "2025-04-30T09:44:49.128584Z"}], "thread_id": "Thread-4", "execution_time": 39.883737325668335, "adapter_response": {"_message": "INSERT 0 0", "code": "INSERT", "rows_affected": 0}, "message": "INSERT 0 0", "failures": null, "unique_id": "model.dbt_lab08_project.dm_sales", "compiled": true, "compiled_code": "with unique_devices as (\n    select distinct\n        click_id,\n        os,\n        os_name,\n        device_type,\n        user_custom_id\n    from \"lab08_db\".\"ods\".\"ods_device_events\"\n),\n\nunique_geo as (\n    select distinct\n        click_id,\n        geo_country,\n        geo_region_name,\n        geo_latitude,\n        geo_longitude\n    from \"lab08_db\".\"ods\".\"ods_geo_events\"\n),\n\ncte_lead as (\n    select\n        obe.load_hour,\n        event_timestamp,\n        event_type,\n        page_url,\n        page_url_path,\n        referer_url,\n        referer_medium,\n        utm_medium,\n        utm_source,\n        utm_content,\n        utm_campaign,\n        browser_name,\n        browser_user_agent,\n        browser_language,\n        os,\n        os_name,\n        user_custom_id,\n        device_type,\n        geo_country,\n        geo_region_name,\n        geo_latitude,\n        geo_longitude,\n        LEAD(page_url_path, 1) over w as next_page_lead1,\n        LEAD(page_url_path, 2) over w as next_page_lead2,\n        LEAD(page_url_path, 3) over w as next_page_lead3,\n        LEAD(event_timestamp, 3) over w as confirmation_timestamp\n    from \"lab08_db\".\"ods\".\"ods_location_events\" as ole\n    inner join\n        \"lab08_db\".\"ods\".\"ods_browser_events\" as obe\n        on ole.event_id = obe.event_id\n    inner join unique_devices as ud on obe.click_id = ud.click_id\n    inner join unique_geo as ug on obe.click_id = ug.click_id\n    where\n        ole.page_url_path != '/home'\n        \n            and ole.load_hour\n            > (select COALESCE(MAX(load_hour), '1900-01-01') from \"lab08_db\".\"dm\".\"dm_sales\")\n            and obe.load_hour\n            > (select COALESCE(MAX(load_hour), '1900-01-01') from \"lab08_db\".\"dm\".\"dm_sales\")\n        \n    window w as (\n        partition by user_custom_id\n        order by event_timestamp\n    )\n)\n\nselect\n    load_hour,\n    user_custom_id as sale_custom_id,\n    event_timestamp,\n    confirmation_timestamp as sale_timestamp,\n    1 as sale_item_cnt,\n    browser_name as sale_browser,\n    device_type as sale_platform,\n    page_url_path as sale_page_before,\n    utm_source as sale_source,\n    utm_campaign as sale_utm_campaign,\n    referer_url as sale_referer_url,\n    referer_medium as sale_referer_medium,\n    utm_content as sale_utm_content,\n    geo_country as sale_geo_country,\n    geo_region_name as sale_geo_region_name,\n    geo_latitude as sale_geo_latitude,\n    geo_longitude as sale_geo_longitude,\n    EXTRACT(hour from confirmation_timestamp) as sale_hour,\n    REPLACE(page_url_path, '/product_', '') as clear_sale_page_before,\n    COALESCE(ic.city_ru, '') as sale_geo_region_name_ru,\n    COALESCE(i.item_ru, '') as clear_sale_page_before_ru\nfrom cte_lead\nleft join \"lab08_db\".\"ods\".\"italian_cities\" as ic on ic.city_en = geo_region_name\nleft join\n    \"lab08_db\".\"ods\".\"items\" as i\n    on i.item_en = REPLACE(page_url_path, '/product_', '')\nwhere\n    (next_page_lead1, next_page_lead2, next_page_lead3)\n    = ('/cart', '/payment', '/confirmation')\n    and page_url_path not in ('/payment', '/cart', '/confirmation')", "relation_name": "\"lab08_db\".\"dm\".\"dm_sales\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-30T09:44:09.267070Z", "completed_at": "2025-04-30T09:44:09.305214Z"}, {"name": "execute", "started_at": "2025-04-30T09:44:09.305928Z", "completed_at": "2025-04-30T09:44:56.257325Z"}], "thread_id": "Thread-3", "execution_time": 47.02355337142944, "adapter_response": {"_message": "INSERT 0 0", "code": "INSERT", "rows_affected": 0}, "message": "INSERT 0 0", "failures": null, "unique_id": "model.dbt_lab08_project.dm_events", "compiled": true, "compiled_code": "with distinct_clicks as (\n    select distinct\n        click_id,\n        device_type\n    from \"lab08_db\".\"ods\".\"ods_device_events\"\n)\n\nselect\n    e.load_hour,\n    e.event_id,\n    e.event_type,\n    e.event_timestamp,\n    e.browser_name,\n    d.device_type,\n    EXTRACT(hour from e.event_timestamp) as event_hour\nfrom \"lab08_db\".\"ods\".\"ods_browser_events\" as e\ninner join distinct_clicks as d on e.click_id = d.click_id\n\n    where load_hour > (\n        select COALESCE(MAX(load_hour), '1900-01-01')\n        from \"lab08_db\".\"dm\".\"dm_events\"\n    )\n", "relation_name": "\"lab08_db\".\"dm\".\"dm_events\""}], "elapsed_time": 172.35808944702148, "args": {"partial_parse": true, "use_colors": true, "invocation_command": "dbt run --profiles-dir /dbt --project-dir /dbt", "populate_cache": true, "which": "run", "write_json": true, "vars": {}, "cache_selected_only": false, "strict_mode": false, "log_level": "info", "profiles_dir": "/dbt", "source_freshness_run_project_hooks": false, "introspect": true, "log_file_max_bytes": 10485760, "log_format": "default", "use_colors_file": true, "exclude": [], "warn_error_options": {"include": [], "exclude": []}, "log_path": "/dbt/logs", "static_parser": true, "indirect_selection": "eager", "require_resource_names_without_spaces": false, "log_format_file": "debug", "quiet": false, "require_explicit_package_overrides_for_builtin_materializations": true, "select": [], "show_resource_report": false, "favor_state": false, "partial_parse_file_diff": true, "print": true, "enable_legacy_logger": false, "empty": false, "macro_debugging": false, "printer_width": 80, "send_anonymous_usage_stats": true, "log_level_file": "debug", "project_dir": "/dbt", "version_check": true, "defer": false}}